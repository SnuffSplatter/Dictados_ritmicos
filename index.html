<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictados Rítmicos - Entrenamiento Musical Avanzado</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 30px 20px;
            text-align: center;
            color: white;
        }
        
        .header h1 {
            font-size: 26px;
            margin-bottom: 5px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px 20px;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .option-btn {
            padding: 10px 6px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
        }
        
        .option-btn:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
        }
        
        .option-btn.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-color: #4facfe;
        }
        
        .cells-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .cell-btn {
            padding: 12px 8px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            min-height: 55px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }
        
        .cell-btn:hover {
            border-color: #764ba2;
            transform: translateY(-2px);
        }
        
        .cell-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #764ba2;
        }
        
        .cell-symbol {
            font-size: 16px;
            font-weight: bold;
        }
        
        .cell-name {
            font-size: 10px;
            opacity: 0.8;
        }
        
        .generate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
        }
        
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result-area {
            background: #f8fafc;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: 2px dashed #cbd5e0;
        }
        
        .result-area.has-content {
            border: 2px solid #4facfe;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }
        
        .rhythm-display {
            font-size: 28px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 10px;
            letter-spacing: 3px;
            line-height: 1.4;
        }
        
        .rhythm-info {
            font-size: 14px;
            color: #718096;
            margin-bottom: 15px;
        }
        
        .control-buttons {
            display: flex;
            gap: 8px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 8px 14px;
            border: 1px solid #4facfe;
            background: white;
            color: #4facfe;
            border-radius: 8px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: #4facfe;
            color: white;
        }
        
        .empty-state {
            color: #a0aec0;
            font-style: italic;
        }
        
        .tempo-control {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .tempo-slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        .tempo-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4facfe;
            cursor: pointer;
        }
        
        .tempo-value {
            font-weight: 600;
            color: #4a5568;
            min-width: 60px;
            text-align: center;
        }
        
        .rhythm-details {
            margin: 15px 0;
            max-height: 180px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            padding: 10px;
        }
        
        .rhythm-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 4px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            font-size: 13px;
        }
        
        .rhythm-item:last-child {
            border-bottom: none;
        }
        
        .item-number {
            font-weight: 600;
            color: #4facfe;
            min-width: 18px;
        }
        
        .item-symbol {
            font-size: 16px;
            min-width: 25px;
            text-align: center;
        }
        
        .item-name {
            flex: 1;
            font-weight: 500;
            color: #2d3748;
        }
        
        .item-value {
            font-size: 11px;
            color: #718096;
            font-style: italic;
        }
        
        .difficulty-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .difficulty-btn {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
        }
        
        .difficulty-btn:hover {
            border-color: #10b981;
            transform: translateY(-1px);
        }
        
        .difficulty-btn.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-color: #10b981;
        }
        
        .creator-signature {
            text-align: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-top: 1px solid #e2e8f0;
            font-size: 12px;
            color: #64748b;
        }
        
        .creator-name {
            font-weight: 600;
            color: #4facfe;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .creator-name:hover {
            color: #667eea;
            text-shadow: 0 0 8px rgba(79, 172, 254, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎵 Dictados Rítmicos Pro</h1>
            <p>Entrenamiento Musical Avanzado</p>
        </div>
        
        <div class="content">
            <!-- Selector de Dificultad -->
            <div class="section">
                <div class="section-title">
                    🎯 Nivel de Dificultad
                </div>
                <div class="difficulty-selector">
                    <div class="difficulty-btn active" data-difficulty="basico">🟢 Básico</div>
                    <div class="difficulty-btn" data-difficulty="intermedio">🟡 Intermedio</div>
                    <div class="difficulty-btn" data-difficulty="avanzado">🔴 Avanzado</div>
                </div>
            </div>
            
            <!-- Selección de Compás -->
            <div class="section">
                <div class="section-title">
                    🎼 Tipo de Compás
                </div>
                <div class="options-grid">
                    <div class="option-btn" data-time-signature="2/4">2/4</div>
                    <div class="option-btn" data-time-signature="3/4">3/4</div>
                    <div class="option-btn active" data-time-signature="4/4">4/4</div>
                    <div class="option-btn" data-time-signature="6/8">6/8</div>
                    <div class="option-btn" data-time-signature="9/8">9/8</div>
                    <div class="option-btn" data-time-signature="12/8">12/8</div>
                    <div class="option-btn" data-time-signature="5/4">5/4</div>
                    <div class="option-btn" data-time-signature="7/8">7/8</div>
                    <div class="option-btn" data-time-signature="2/2">2/2</div>
                </div>
            </div>
            
            <!-- Selección de Células Rítmicas -->
            <div class="section">
                <div class="section-title">
                    🎶 Figuras Musicales
                </div>
                <div class="cells-grid" id="cellsGrid">
                    <!-- Las células se cargan dinámicamente según la dificultad -->
                </div>
            </div>
            
            <!-- Tempo Fijo -->
            <div class="section">
                <div class="section-title">
                    ⏱️ Tempo: 60 BPM (Fijo)
                </div>
            </div>
            
            <!-- Botón Generar -->
            <button class="generate-btn" id="generateBtn">
                🎲 Generar Dictado Rítmico
            </button>
            
            <!-- Área de Resultado -->
            <div class="result-area" id="resultArea">
                <div class="empty-state">
                    Selecciona el nivel de dificultad y presiona "Generar" para crear tu dictado rítmico
                </div>
            </div>
        </div>
        
        <!-- Firma del Creador -->
        <div class="creator-signature">
            🎵 Creado con ♪ por <span class="creator-name">Ezequiel López</span> • Dictados Rítmicos Pro
        </div>
    </div>

    <script>
        class AdvancedRhythmTrainer {
            constructor() {
                this.selectedTimeSignature = '4/4';
                this.selectedCells = [];
                this.tempo = 60;
                this.currentRhythm = null;
                this.difficulty = 'basico';
                
                // Banco completo de figuras rítmicas con valores en corcheas
                this.todasLasFiguras = {
                    // Figuras básicas
                    'redonda': { nombre: 'Redonda', valor: 8, simbolo: '𝅝', silencio: '𝄻', nivel: 'basico' },
                    'blanca': { nombre: 'Blanca', valor: 4, simbolo: '𝅗𝅥', silencio: '𝄼', nivel: 'basico' },
                    'negra': { nombre: 'Negra', valor: 2, simbolo: '♩', silencio: '𝄽', nivel: 'basico' },
                    'corchea': { nombre: 'Corchea', valor: 1, simbolo: '♫', silencio: '𝄾', nivel: 'basico' },
                    
                    // Figuras intermedias
                    'semicorchea': { nombre: 'Semicorchea', valor: 0.5, simbolo: '♬', silencio: '𝄿', nivel: 'intermedio' },
                    'fusa': { nombre: 'Fusa', valor: 0.25, simbolo: '𝅘𝅥𝅰', silencio: '𝅘𝅥𝅱', nivel: 'intermedio' },
                    'semifusa': { nombre: 'Semifusa', valor: 0.125, simbolo: '𝅘𝅥𝅲', silencio: '𝅘𝅥𝅳', nivel: 'avanzado' },
                    
                    // Puntillos
                    'negra-puntillo': { nombre: 'Negra con puntillo', valor: 3, simbolo: '♩.', silencio: '𝄽.', nivel: 'intermedio' },
                    'blanca-puntillo': { nombre: 'Blanca con puntillo', valor: 6, simbolo: '𝅗𝅥.', silencio: '𝄼.', nivel: 'intermedio' },
                    'corchea-puntillo': { nombre: 'Corchea con puntillo', valor: 1.5, simbolo: '♫.', silencio: '𝄾.', nivel: 'intermedio' },
                    'semicorchea-puntillo': { nombre: 'Semicorchea con puntillo', valor: 0.75, simbolo: '♬.', silencio: '𝄿.', nivel: 'avanzado' },
                    
                    // Doble puntillo
                    'negra-doble-puntillo': { nombre: 'Negra doble puntillo', valor: 3.5, simbolo: '♩..', silencio: '𝄽..', nivel: 'avanzado' },
                    'blanca-doble-puntillo': { nombre: 'Blanca doble puntillo', valor: 7, simbolo: '𝅗𝅥..', silencio: '𝄼..', nivel: 'avanzado' },
                    
                    // Tresillos
                    'tresillo-negras': { nombre: 'Tresillo de negras', valor: 2.67, simbolo: '♩♩♩', silencio: '𝄽𝄽𝄽', nivel: 'intermedio' },
                    'tresillo-corcheas': { nombre: 'Tresillo de corcheas', valor: 1.33, simbolo: '♫♫♫', silencio: '𝄾𝄾𝄾', nivel: 'intermedio' },
                    'tresillo-semicorcheas': { nombre: 'Tresillo de semicorcheas', valor: 0.67, simbolo: '♬♬♬', silencio: '𝄿𝄿𝄿', nivel: 'avanzado' },
                    
                    // Seisillos
                    'seisillo': { nombre: 'Seisillo', valor: 1, simbolo: '♬♬♬♬♬♬', silencio: '𝄿𝄿𝄿𝄿𝄿𝄿', nivel: 'avanzado' },
                    
                    // Cinquillos
                    'cinquillo': { nombre: 'Cinquillo', valor: 1.6, simbolo: '♫♫♫♫♫', silencio: '𝄾𝄾𝄾𝄾𝄾', nivel: 'avanzado' },
                    
                    // Síncopas
                    'sincopa-simple': { nombre: 'Síncopa simple', valor: 2, simbolo: '♫♩♫', silencio: '𝄾𝄽𝄾', nivel: 'intermedio' },
                    'sincopa-larga': { nombre: 'Síncopa larga', valor: 4, simbolo: '♫♪♫', silencio: '𝄾𝄼𝄾', nivel: 'intermedio' },
                    'sincopa-corta': { nombre: 'Síncopa corta', valor: 1, simbolo: '♬♫♬', silencio: '𝄿𝄾𝄿', nivel: 'avanzado' },
                    
                    // Contratiempos
                    'contratiempo': { nombre: 'Contratiempo', valor: 2, simbolo: '𝄽♩', silencio: '♩𝄽', nivel: 'intermedio' },
                    'contratiempo-doble': { nombre: 'Contratiempo doble', valor: 2, simbolo: '𝄾♫𝄾', silencio: '♫𝄾♫', nivel: 'avanzado' },
                    
                    // Figuras compuestas
                    'corchea-dos-semicorcheas': { nombre: 'Corchea + 2 semicorcheas', valor: 2, simbolo: '♫♬♬', silencio: '𝄾𝄿𝄿', nivel: 'intermedio' },
                    'dos-semicorcheas-corchea': { nombre: '2 semicorcheas + corchea', valor: 2, simbolo: '♬♬♫', silencio: '𝄿𝄿𝄾', nivel: 'intermedio' },
                    'semicorchea-corchea-semicorchea': { nombre: 'Semicorchea-corchea-semicorchea', valor: 2, simbolo: '♬♫♬', silencio: '𝄿𝄾𝄿', nivel: 'avanzado' },
                    
                    // Figuras de jazz
                    'swing-corcheas': { nombre: 'Swing de corcheas', valor: 2, simbolo: '♫♫', silencio: '𝄾𝄾', nivel: 'avanzado' },
                    'shuffle': { nombre: 'Shuffle', valor: 2, simbolo: '♫.♬', silencio: '𝄾.𝄿', nivel: 'avanzado' },
                    
                    // Combinaciones prácticas adicionales
                    'cuatro-semicorcheas': { nombre: '4 semicorcheas', valor: 2, simbolo: '♬♬♬♬', silencio: '𝄿𝄿𝄿𝄿', nivel: 'intermedio' },
                    'dos-corcheas': { nombre: '2 corcheas', valor: 2, simbolo: '♫♫', silencio: '𝄾𝄾', nivel: 'basico' },
                    'negra-corchea': { nombre: 'Negra + corchea', valor: 3, simbolo: '♩♫', silencio: '𝄽𝄾', nivel: 'intermedio' },
                    'corchea-negra': { nombre: 'Corchea + negra', valor: 3, simbolo: '♫♩', silencio: '𝄾𝄽', nivel: 'intermedio' },
                    'blanca-corchea': { nombre: 'Blanca + corchea', valor: 5, simbolo: '𝅗𝅥♫', silencio: '𝄼𝄾', nivel: 'intermedio' },
                    'tres-corcheas': { nombre: '3 corcheas', valor: 3, simbolo: '♫♫♫', silencio: '𝄾𝄾𝄾', nivel: 'basico' },
                    'anacrusa-corchea': { nombre: 'Anacrusa de corchea', valor: 1, simbolo: '♫', silencio: '𝄾', nivel: 'intermedio' }
                };
                
                // Conversión del compás a número de corcheas
                this.corcheasPorCompas = {
                    '2/4': 4, '3/4': 6, '4/4': 8, '6/8': 6, '9/8': 9, '12/8': 12,
                    '5/4': 10, '7/8': 7, '2/2': 8
                };
                
                this.init();
            }
            
            init() {
                this.bindEvents();
                this.updateCellsForDifficulty();
                this.updateUI();
            }
            
            bindEvents() {
                // Selección de dificultad
                document.querySelectorAll('[data-difficulty]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('[data-difficulty]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.difficulty = e.target.dataset.difficulty;
                        this.updateCellsForDifficulty();
                    });
                });
                
                // Selección de compás
                document.querySelectorAll('[data-time-signature]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('[data-time-signature]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.selectedTimeSignature = e.target.dataset.timeSignature;
                    });
                });
                
                // Tempo fijo en 60 BPM
                
                // Botón generar
                document.getElementById('generateBtn').addEventListener('click', () => {
                    this.generateRhythm();
                });
            }
            
            updateCellsForDifficulty() {
                const cellsGrid = document.getElementById('cellsGrid');
                cellsGrid.innerHTML = '';
                
                // Filtrar figuras por nivel de dificultad
                const figurasDisponibles = Object.entries(this.todasLasFiguras).filter(([key, figura]) => {
                    if (this.difficulty === 'basico') return figura.nivel === 'basico';
                    if (this.difficulty === 'intermedio') return figura.nivel === 'basico' || figura.nivel === 'intermedio';
                    return true; // avanzado incluye todas
                });
                
                // Crear botones para las figuras disponibles
                figurasDisponibles.forEach(([key, figura]) => {
                    const btn = document.createElement('div');
                    btn.className = 'cell-btn';
                    btn.dataset.cell = key;
                    
                    // Seleccionar automáticamente algunas figuras básicas
                    if (this.difficulty === 'basico' && ['negra', 'corchea', 'blanca'].includes(key)) {
                        btn.classList.add('active');
                    }
                    
                    btn.innerHTML = `
                        <div class="cell-symbol">${figura.simbolo}</div>
                        <div class="cell-name">${figura.nombre}</div>
                    `;
                    
                    btn.addEventListener('click', (e) => {
                        e.currentTarget.classList.toggle('active');
                        this.updateSelectedCells();
                    });
                    
                    cellsGrid.appendChild(btn);
                });
                
                this.updateSelectedCells();
            }
            
            updateSelectedCells() {
                this.selectedCells = Array.from(document.querySelectorAll('[data-cell].active'))
                    .map(btn => btn.dataset.cell);
                
                const generateBtn = document.getElementById('generateBtn');
                generateBtn.disabled = this.selectedCells.length === 0;
            }
            
            generateRhythm() {
                if (this.selectedCells.length === 0) return;
                
                const corcheasPorCompas = this.corcheasPorCompas[this.selectedTimeSignature];
                const numeroCompases = 4; // Generar 4 compases
                const patronGenerado = [];
                
                // Generar 4 compases
                for (let compas = 0; compas < numeroCompases; compas++) {
                    let restantes = corcheasPorCompas;
                    const patronCompas = [];
                
                    // Generar patrón hasta completar el compás EXACTAMENTE
                    let ultimoEsSilencio = false;
                    
                    while (restantes > 0) {
                        // Filtrar solo figuras que caben exactamente o que permiten completar el compás
                        const figurasQueCaben = this.selectedCells
                            .map(cell => this.todasLasFiguras[cell])
                            .filter(fig => fig.valor <= restantes);
                        
                        if (figurasQueCaben.length === 0) {
                            // Si no hay figuras que caben, completar con la más pequeña disponible
                            if (restantes >= 1) {
                                patronCompas.push({
                                    simbolo: '♫',
                                    nombre: 'Corchea',
                                    valor: 1
                                });
                                restantes -= 1;
                            } else if (restantes >= 0.5) {
                                patronCompas.push({
                                    simbolo: '♬',
                                    nombre: 'Semicorchea',
                                    valor: 0.5
                                });
                                restantes -= 0.5;
                            } else {
                                // Ajustar cualquier resto decimal
                                restantes = 0;
                            }
                            continue;
                        }
                        
                        // Elegir una figura aleatoria de las que caben
                        const figuraElegida = figurasQueCaben[Math.floor(Math.random() * figurasQueCaben.length)];
                        
                        // Verificar que el valor sea exacto (sin decimales problemáticos)
                        const valorExacto = Math.round(figuraElegida.valor * 2) / 2; // Redondear a medios
                        
                        if (valorExacto <= restantes) {
                            // Probabilidad de silencio muy reducida y evitar silencios consecutivos
                            const probabilidadSilencio = ultimoEsSilencio ? 0 : 
                                                       (this.difficulty === 'basico' ? 0.02 : 
                                                        this.difficulty === 'intermedio' ? 0.05 : 0.08);
                            const esSilencio = Math.random() < probabilidadSilencio;
                            
                            if (esSilencio && !ultimoEsSilencio) {
                                patronCompas.push({
                                    simbolo: figuraElegida.silencio,
                                    nombre: `Silencio de ${figuraElegida.nombre.toLowerCase()}`,
                                    valor: valorExacto
                                });
                                ultimoEsSilencio = true;
                            } else {
                                patronCompas.push({
                                    simbolo: figuraElegida.simbolo,
                                    nombre: figuraElegida.nombre,
                                    valor: valorExacto
                                });
                                ultimoEsSilencio = false;
                            }
                            
                            restantes -= valorExacto;
                            
                            // Redondear restantes para evitar problemas de punto flotante
                            restantes = Math.round(restantes * 2) / 2;
                        } else {
                            // Si por alguna razón no cabe, completar con corcheas
                            if (restantes >= 1) {
                                patronCompas.push({
                                    simbolo: '♫',
                                    nombre: 'Corchea',
                                    valor: 1
                                });
                                restantes -= 1;
                            } else if (restantes >= 0.5) {
                                patronCompas.push({
                                    simbolo: '♬',
                                    nombre: 'Semicorchea',
                                    valor: 0.5
                                });
                                restantes -= 0.5;
                            } else {
                                restantes = 0;
                            }
                        }
                    }
                    
                    // Verificar que el compás suma exactamente lo correcto
                    const sumaCompas = patronCompas.reduce((sum, item) => sum + item.valor, 0);
                    if (Math.abs(sumaCompas - corcheasPorCompas) > 0.01) {
                        console.warn(`Compás ${compas + 1}: suma ${sumaCompas}, esperado ${corcheasPorCompas}`);
                    }
                    
                    // Agregar separador de compás
                    patronCompas.push({
                        simbolo: '|',
                        nombre: 'Barra de compás',
                        valor: 0,
                        esBarraCompas: true
                    });
                    
                    patronGenerado.push(...patronCompas);
                }
                
                // Agregar doble barra final
                patronGenerado[patronGenerado.length - 1] = {
                    simbolo: '||',
                    nombre: 'Doble barra final',
                    valor: 0,
                    esBarraFinal: true
                };
                
                this.currentRhythm = {
                    pattern: patronGenerado,
                    timeSignature: this.selectedTimeSignature,
                    tempo: this.tempo,
                    cells: [...this.selectedCells],
                    corcheasPorCompas: corcheasPorCompas,
                    numeroCompases: numeroCompases,
                    difficulty: this.difficulty
                };
                
                this.displayRhythm();
            }
            
            displayRhythm() {
                const resultArea = document.getElementById('resultArea');
                
                if (!this.currentRhythm) return;
                
                resultArea.classList.add('has-content');
                
                const simbolos = this.currentRhythm.pattern.map(item => item.simbolo).join(' ');
                const detallesList = this.currentRhythm.pattern
                    .filter(item => !item.esBarraCompas && !item.esBarraFinal)
                    .map((item, index) => 
                        `<div class="rhythm-item">
                            <span class="item-number">${index + 1}.</span>
                            <span class="item-symbol">${item.simbolo}</span>
                            <span class="item-name">${item.nombre}</span>
                            <span class="item-value">(${item.valor} corcheas)</span>
                        </div>`
                    ).join('');
                
                const difficultyEmoji = this.currentRhythm.difficulty === 'basico' ? '🟢' : 
                                      this.currentRhythm.difficulty === 'intermedio' ? '🟡' : '🔴';
                
                resultArea.innerHTML = `
                    <div class="rhythm-display" id="rhythmDisplay" style="display: none;">
                        ${simbolos}
                    </div>
                    <div class="rhythm-info">
                        ${difficultyEmoji} ${this.currentRhythm.difficulty.toUpperCase()} • Compás: ${this.currentRhythm.timeSignature} • Tempo: ${this.currentRhythm.tempo} BPM • ${this.currentRhythm.numeroCompases} compases
                    </div>
                    <div class="rhythm-details" id="rhythmDetails" style="display: none;">
                        ${detallesList}
                    </div>
                    <div class="control-buttons">
                        <button class="control-btn" onclick="rhythmTrainer.generateRhythm()">🔄 Nuevo</button>
                        <button class="control-btn" onclick="rhythmTrainer.playRhythm()">▶️ Reproducir</button>
                        <button class="control-btn" onclick="rhythmTrainer.repeatRhythm()">🔁 Repetir</button>
                        <button class="control-btn" onclick="rhythmTrainer.showSolution()">💡 Solución</button>
                        <button class="control-btn" onclick="rhythmTrainer.exportPattern()">📋 Exportar</button>
                    </div>
                `;
            }
            
            playRhythm() {
                const rhythmDisplay = document.querySelector('.rhythm-display');
                const originalText = rhythmDisplay.textContent;
                
                rhythmDisplay.style.color = '#ff6b6b';
                rhythmDisplay.textContent = '🎵 Reproduciendo...';
                
                setTimeout(() => {
                    rhythmDisplay.style.color = '#2d3748';
                    rhythmDisplay.textContent = originalText;
                }, 2500);
            }
            
            repeatRhythm() {
                const rhythmDisplay = document.querySelector('.rhythm-display');
                const originalText = rhythmDisplay.textContent;
                
                rhythmDisplay.style.color = '#10b981';
                rhythmDisplay.textContent = '🔁 Repitiendo dictado...';
                
                setTimeout(() => {
                    rhythmDisplay.style.color = '#2d3748';
                    rhythmDisplay.textContent = originalText;
                }, 3000);
            }
            
            showSolution() {
                if (!this.currentRhythm) return;
                
                const rhythmDisplay = document.getElementById('rhythmDisplay');
                const rhythmDetails = document.getElementById('rhythmDetails');
                const solutionBtn = document.querySelector('.control-btn[onclick="rhythmTrainer.showSolution()"]');
                
                if (rhythmDisplay.style.display === 'none') {
                    // Mostrar la solución completa
                    rhythmDisplay.style.display = 'block';
                    rhythmDetails.style.display = 'block';
                    solutionBtn.innerHTML = '🙈 Ocultar Solución';
                    solutionBtn.style.background = '#10b981';
                    solutionBtn.style.color = 'white';
                    solutionBtn.style.borderColor = '#10b981';
                } else {
                    // Ocultar la solución completa
                    rhythmDisplay.style.display = 'none';
                    rhythmDetails.style.display = 'none';
                    solutionBtn.innerHTML = '💡 Solución';
                    solutionBtn.style.background = 'white';
                    solutionBtn.style.color = '#4facfe';
                    solutionBtn.style.borderColor = '#4facfe';
                }
            }
            
            exportPattern() {
                if (!this.currentRhythm) return;
                
                const exportData = {
                    simbolos: this.currentRhythm.pattern.map(item => item.simbolo).join(' '),
                    patron: this.currentRhythm.pattern.map(item => item.nombre).join(' - '),
                    compas: this.currentRhythm.timeSignature,
                    tempo: this.currentRhythm.tempo,
                    dificultad: this.currentRhythm.difficulty,
                    fecha: new Date().toLocaleDateString()
                };
                
                const exportText = `DICTADO RÍTMICO EXPORTADO
========================
Fecha: ${exportData.fecha}
Nivel: ${exportData.dificultad}
Compás: ${exportData.compas}
Tempo: ${exportData.tempo} BPM

Símbolos: ${exportData.simbolos}
Patrón: ${exportData.patron}

Generado con Dictados Rítmicos Pro`;
                
                // Copiar al portapapeles
                navigator.clipboard.writeText(exportText).then(() => {
                    alert('📋 ¡Patrón copiado al portapapeles!\n\nPuedes pegarlo en cualquier editor de texto o documento.');
                }).catch(() => {
                    // Fallback si no funciona el portapapeles
                    const textarea = document.createElement('textarea');
                    textarea.value = exportText;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    alert('📋 ¡Patrón copiado al portapapeles!');
                });
            }
            
            updateUI() {
                this.updateSelectedCells();
            }
        }
        
        // Inicializar la aplicación
        const rhythmTrainer = new AdvancedRhythmTrainer();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96f9a2e666d1dea9',t:'MTc1NTI3MDgxMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
